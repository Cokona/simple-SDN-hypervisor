# To USE    --- sh commands_for_3b.txt

# TO CLEAN  --- sudo ovs-ofctl del-flows s1

# To Dump FLows ---- sh ovs-ofctl -O OpenFlow13 dump-flows s1

sudo ovs-vsctl set bridge s1 protocols=OpenFlow13

# Table 0
sudo ovs-ofctl -O OpenFlow13 add-flow s1 arp,nw_src=192.168.0.0/24,nw_dst=192.168.0.0/24,priority=10,actions=goto_table:1
sudo ovs-ofctl -O OpenFlow13 add-flow s1 ip,nw_src=192.168.0.0/24,nw_dst=192.168.0.0/24,priority=10,actions=goto_table:1
sudo ovs-ofctl -O OpenFlow13 add-flow s1 icmp,nw_src=192.168.0.1,nw_dst=10.0.0.1,priority=10,actions=output:3
sudo ovs-ofctl -O OpenFlow13 add-flow s1 icmp,nw_dst=192.168.0.1,nw_src=10.0.0.1,priority=10,actions=output:1
sudo ovs-ofctl -O OpenFlow13 add-flow s1 dl_type=0x0800,nw_proto=6,tp_dst=80,nw_src=192.168.0.1,nw_dst=10.0.0.1,priority=10,actions=output:3
sudo ovs-ofctl -O OpenFlow13 add-flow s1 dl_type=0x0800,nw_proto=6,tp_dst=80,nw_dst=192.168.0.1,nw_src=10.0.0.1,priority=10,actions=output:1
sudo ovs-ofctl -O OpenFlow13 add-flow s1 ip,nw_src=10.0.0.1,priority=10,actions=goto_table:2
sudo ovs-ofctl -O OpenFlow13 add-flow s1 ip,nw_dst=10.0.0.1,priority=10,actions=goto_table:2   # JUST ADDED
sudo ovs-ofctl -O OpenFlow13 add-flow s1 priority=0,actions=drop

# Table 1
sudo ovs-ofctl -O OpenFlow13 add-flow s1 ip,table=1,priority=10,dl_type=0x0800,nw_src=192.168.0.1,nw_dst=10.0.0.1,actions=mod_nw_src=5.5.5.5,goto_table:2
sudo ovs-ofctl -O OpenFlow13 add-flow s1 ip,table=1,priority=10,dl_type=0x0800,nw_src=10.0.0.1,nw_dst=5.5.5.5,actions=mod_nw_dst=192.168.0.1,goto_table:2
sudo ovs-ofctl -O OpenFlow13 add-flow s1 table=1,priority=0,actions=goto_table:2

# Table 2
sudo ovs-ofctl -O OpenFlow13 add-flow s1 ip,table=2,priority=10,dl_type=0x0800,nw_dst=192.168.0.1,actions=mod_dl_dst=00:00:00:00:00:01,output:1
sudo ovs-ofctl -O OpenFlow13 add-flow s1 ip,table=2,priority=10,dl_type=0x0800,nw_dst=192.168.0.2,actions=mod_dl_dst=00:00:00:00:00:02,output:2
sudo ovs-ofctl -O OpenFlow13 add-flow s1 ip,table=2,priority=10,dl_type=0x0800,nw_dst=10.0.0.1,actions=mod_dl_dst=00:00:00:00:00:03,output:1
sudo ovs-ofctl -O OpenFlow13 add-flow s1 arp,table=2,priority=0,nw_dst=192.168.0.1,actions=output:1
sudo ovs-ofctl -O OpenFlow13 add-flow s1 arp,table=2,priority=0,nw_dst=192.168.0.2,actions=output:2
sudo ovs-ofctl -O OpenFlow13 add-flow s1 arp,table=2,priority=0,nw_dst=10.0.0.1,actions=output:3


